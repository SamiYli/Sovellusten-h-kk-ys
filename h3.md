# H3
# a) Strings. Löydä salasana ja lippu katsomatta lähdekoodia.
Tämä onnistui 'strings' komennolla. 
Latasin Kotilab1 virtuaalikoneelleni [ezbin-challenges.zip](https://terokarvinen.com/loota/yctjx7/ezbin-challenges.zip), josta "passtr" niminen ohjelma löytyy. Sitten tiedoston purku ja hakemistoon siirtyminen, jonka jälkeen katsotaan luettavia merkkijonoja binääristä komennolla:
```
strings passtr
```

![Onnistunut strings](strings_passtr(1).JPG)

Sieltä löytyi kaikennäköisiä tekstejä, mutta sala-hakkeri-321 ja FLAG pisti silmään. Joten päättelin lipun löytyneen ja testasin vielä salasanaa ohjelmassa.

![Onnistunut salasana](password&flag_passtr.JPG)

```
Password: sala-hakkeri-321     FLAG{Tero-d75ee66af0a68663f15539ec0f46e3b1}
```

# b) Tee uusi versio passtr.c ohjelmasta, jossa salasana ei näy suoraan binääristä.
Tämä vaati, jonkin verran lukemista, koska C on minulle vielä vierasta. 
Löysin hyvän artikkelin tähän "Obfuscating strings" aiheeseen. [(yurisk.info string-obfuscating-in-C)](<https://yurisk.info/2017/06/25/binary-obfuscation-string-obfuscating-in-C/>) Tiivistettynä idea on siis kääntää merkkijonot ei luettaviksi lisäämällä tai poistamalla merkkeihin integer arvo ja säilyttää ne taulukossa. Kun ne käännetään takaisin luettavaksi, poistamalla tai lisäämällä se sama integer arvo. 

## Alkuperäinen lähdekoodi passtr
```
// passtr - a simple static analysis warm up exercise
// Copyright 2024 Tero Karvinen https://TeroKarvinen.com

#include <stdio.h>
#include <string.h>

int main() {
	char password[20];
	
	printf("What's the password?\n");
	scanf("%19s", password);
	if (0 == strcmp(password, "sala-hakkeri-321")) {
		printf("Yes! That's the password. FLAG{Tero-d75ee66af0a68663f15539ec0f46e3b1}\n");
	} else {
		printf("Sorry, no bonus.\n");
	}
	return 0;
}
```
### Tiedoston muokkaamiseen micro tekstieditorilla ja kääntämiseen gcc:llä eli GNU compiler collection löytyi /passtr hakemistosta tiedostot, jossa oli komennot niiden käyttöön.


## Obfuscating versio lähdekoodista

```
#include <stdio.h>
#include <string.h>

#define K 0x5A // Tässä määrittelen lisättävän arvon

static void decode(char *s) {
	while (*s) {
		*s ^= K;
		s++;
	}
}  // Funktio decode purkaa salauksen poistamalla arvon

int main() {
	char password[20];
	char pw[] = {
		's'^K,'a'^K,'l'^K,'a'^K,'-'^K,'h'^K,'a'^K,'k'^K,
		'k'^K,'e'^K,'r'^K,'i'^K,'-'^K,'3'^K,'2'^K,'1'^K,'\0'
	}; // Tässä on taulukko jossa salasana säilytetään obfuskoituna
	
	printf("What's the password?\n");
	scanf("%19s", password);

	decode(pw);
	
	if (0 == strcmp(password, pw)) {
		printf("Yes! That's the password. FLAG{Tero-d75ee66af0a68663f15539ec0f46e3b1}\n");
	} else {
		printf("Sorry, no bonus.\n");
	}
	
	return 0;
}

```
Nyt salasana ei enää näy käyttämällä strings komentoa. Tarkistin tämän käyttämällä 'strings passtr2' komentoa:
![Obfuscated passtr strings](strings_passtr2.JPG)
